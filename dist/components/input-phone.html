<script src="../vuel.min.js"></script>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flag-icon-css@3.0.0/css/flag-icon.min.css">
<script src="https://cdn.jsdelivr.net/npm/jquery-mask-plugin@1.14.15/dist/jquery.mask.min.js"></script>

<template id="input-phone">
	<div>
		<div class="input-group">
			<div class="input-group-prepend">
				<div class="input-group-text">
					<div :class="country.className"></div>
					<div class="list-group input-phone-countries-dropdown" style="display:none;">
						<div class="list-group-item" v-for="c in countries" @click="_setCountry(c);">
							<span :class="c.className"></span> &nbsp;
							{{ c.name }}
						</div>
					</div>
				</div>
			</div>
			<input type="text" class="form-control input-phone-input" :name="name" :placeholder="country.mask" v-model="phone">
		</div>
		<pre>{{ $data }}</pre>
	</div>
</template>

<script>
Vue.vuel("input-phone", {
	data: {
		name: "",
		value: "",
		phone: "",
		country: {
			"code": "+55",
			"name": "Brasil",
			"className": "flag-icon flag-icon-br",
			"mask": "(99) 99999-9999"
		},
		countries: [
			{code:"+55", name:"Brasil", className:"flag-icon flag-icon-br", mask:"(00) 00000-0000"},
			{code:"+1", name:"USA", className:"flag-icon flag-icon-us", mask:"000-000"},
			{code:"+351", name:"Portugal", className:"flag-icon flag-icon-pt", mask:"00-0000"},
		],
	},
	methods: {
		_setCountry: function(country) {
			var vm=this, $=jQuery;
			Vue.set(vm, "country", country);
			Vue.set(vm, "value", vm.country.code+" "+vm.phone);
		},
	},
	mounted: function() {
		var vm=this, $=jQuery;
		$(vm.$el).find(".input-phone-input").on("focus", function() {
			$(vm.$el).find(".input-phone-countries-dropdown").slideDown(200);
		});
		$(vm.$el).find(".input-phone-input").on("blur", function() {
			setTimeout(function() {
				$(vm.$el).find(".input-phone-countries-dropdown").slideUp(200);
			}, 50);
		});
		$(vm.$el).find(".input-phone-input").on("keyup", function() {
			Vue.set(vm, "value", vm.country.code+" "+vm.phone);
		});

		var SPMaskBehavior = function (val) { return vm.country.mask; },
		spOptions = {
			onKeyPress: function(val, e, field, options) {
				// field.mask(SPMaskBehavior.apply({}, arguments), options);
				field.mask(vm.country.mask, options);
			}
		};

		$(vm.$el).find(".input-phone-input").mask(SPMaskBehavior, spOptions);
	},
});
</script>

<style>
input-phone {}
input-phone .input-group-prepend .input-group-text {position:relative;}
input-phone .input-group-prepend .input-group-text .list-group {position:absolute; top:100%; left:0; width:250px;}
input-phone .input-group-prepend .input-group-text .list-group .list-group-item {text-align:left; cursor:pointer;}
</style>